---
javascript之文档加载
---

##文档加载事件
大部分Web应用都需要Web浏览器通知他们文档加载的完毕和为操作准备就绪的时间，window对象的load事件就是为了这个目的。load事件直到所有文档和所有图片加载完毕时才发生。然而，文档完全解析之后但在所有图片加载完毕之前开始运行脚本通常是安全的，所以如果基于`load`发生之前的事件触发脚本会提升web应用的启动时间。

当文档加载完毕且所有延迟脚本都能执行完毕是会触发DOMContentLoaded事件，此时图片和异步脚本可能还在加载，但文档已经为操作准备就绪了。

```
window.onload=function(){
	//将javascript的代码放到这里
}
```



###客户端javascript的时间线(javascript权威指南：13.3.4)

1. Web浏览器创建Document对象，并且开始解析Web页面，解析HTML元素和他们的文本内容后添加Element对象和Text节点到文档中。这个阶段`document.readystate`属性值是`'loading'`。

2. 当HTML解析器遇到async和defer属性的javascript元素时，他会把这些属性添加到文档中，然后执行内部或外部脚本。这些脚本会同步执行，并且在下载和执行时解析器会暂停。这样就可以用document.write()来把文本插入到输入流中，解析器恢复时这些文本会成为文档的一部分。同步脚本经常简单定义函数和注册后面使用的注册事件处理程序，但他们可以遍历和操作文档树，因为他们执行时已经存在。

3. 当解析遇到设置async属性的`<script>`元素时，他开始下载脚本文本，并继续解析文档。脚本会在它下载完成后尽快执行，但解析器不会停下来等它下载。
4. 但文档完成解析,`docuemnt.readyState`属性变为`'interctive'`。
5. 所有有defer属性的脚本，会按它们在文档的李出现的顺序执行。异步脚本可能也会在这个时间执行。延迟脚本能访问完整的文档树，禁止使用document.write()方法。
6. 浏览器在Document对象上触发DOMCotentLoaded事件，。这标志着程序执行阶段转换到事件驱动阶段。
7. 这时，文档已经完全解析完成，但浏览器可能还在等待其他内容的载入，如图片。当所有这些内容完成加载时，并且所有异步脚本完成载入和执行，`document.readState`属性改变为`'complete'`,web浏览器触发window对象上的load事件。

这是一条理想的时间线，但所有的浏览器都没有支持它的全部细节。所有的浏览器普遍支持load事件,都会触发它，它是取决文档完全载入并可以操作的最通用的技术。
 



##jQuery
### $(document).ready()函数介绍
```
$(document).ready(){
	//将jquery代码放在这里
}
```
$(document).ready()函数相比其他的获取javascript事件，并执行相应事件有很多种优势。
- 该函数不需要再HTML代码中进行任何的标记行为，就可以分离javascript代码到每个独立的文件中。因此很容易对内容无关的代码进行维护。
- 在一些传统页面中，可以会在`<body>`标签中有onload属性，该属性限定只能执行一个函数，并且也将'行为'标记引入到页面函数中。
- 在$(document).ready()函数括号中所有代码都会提前(只要DOM在浏览器中被注册完毕)被执行，而不是在页面所有内容加载完毕之后才执行函数。

###  多个$(document.read())函数
`$(document).read()`函数的另一个功能，即他可以被多次使用。如果不太在意代码的大小，那么可以将`$(document).read()`函数放到所有的javascript文件中。无论函数是在一个文件中，还是在多个文件中，他都可以将这些函数归组。

###$(function(){...})
最后，可以使用`$(function(){...})`来代替`$(document).read()`
```
$(function(){
	//将jQuery代码放在这里
})
```
